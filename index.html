<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>NEON SKY 3D â€¢ Fireworks</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

  <style>
    :root {
      color-scheme: dark;
      --bg: #020312;
      --panel-bg: rgba(8, 10, 30, 0.92);
      --panel-border: rgba(255, 255, 255, 0.06);
      --accent: #5b8dff;
      --accent-strong: #91e6ff;
      --text-main: #f9fbff;
      --text-muted: #a3b1d9;
      --radius-pill: 999px;
      --radius-lg: 18px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-user-select: none; }

    html, body {
      width: 100%; height: 100%; overflow: hidden;
      background: radial-gradient(circle at top, #1c1b3f 0, #020312 52%, #000000 100%);
      font-family: "Inter", system-ui, sans-serif;
      color: var(--text-main);
    }

    canvas {
      position: absolute; inset: 0; width: 100%; height: 100%;
      pointer-events: auto; z-index: 1;
    }

    .ui-root {
      position: relative; z-index: 10;
      display: flex; flex-direction: column;
      width: 100%; height: 100%;
      padding: 16px; pointer-events: none;
    }

    .ui-top {
      display: flex; justify-content: space-between; align-items: flex-start; gap: 16px;
    }

    .panel {
      background: linear-gradient(135deg, rgba(8, 10, 30, 0.96), rgba(10, 16, 41, 0.9));
      border: 1px solid var(--panel-border);
      border-radius: var(--radius-lg);
      padding: 14px;
      backdrop-filter: blur(20px);
      pointer-events: auto;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
      max-width: 300px;
    }

    .app-title { font-weight: 700; font-size: 14px; letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 4px; display:flex; align-items:center; gap:8px; }
    .badge { background: rgba(91,141,255,0.2); color: #91e6ff; padding: 2px 6px; border-radius: 4px; font-size: 10px; }
    
    .metrics { display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap; }
    .metric { 
      background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
      padding: 4px 8px; border-radius: var(--radius-pill); font-size: 11px; color: var(--text-muted);
    }
    .metric b { color: #fff; margin-left: 4px; }

    .launch-area { margin-top: 16px; display: flex; align-items: center; justify-content: space-between; }
    .launch-btn {
      width: 140px; height: 48px;
      background: radial-gradient(circle at top, rgba(255,255,255,0.1), rgba(10,10,30,1));
      border: 1px solid var(--accent); border-radius: var(--radius-pill);
      color: var(--accent-strong); font-weight: 600; letter-spacing: 0.1em; font-size: 12px;
      cursor: pointer; box-shadow: 0 0 15px rgba(91,141,255,0.2);
      transition: transform 0.1s; display: grid; place-items: center;
      position: relative; overflow: hidden;
    }
    .launch-btn:active { transform: scale(0.96); box-shadow: 0 0 25px rgba(91,141,255,0.6); }
    .launch-btn.holding { animation: pulse 0.6s ease-in-out; border-color: #ff6b9d; }
    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 15px rgba(255,107,157,0.3); }
      50% { box-shadow: 0 0 30px rgba(255,107,157,0.8); }
    }

    .ui-bottom { margin-top: auto; display: flex; gap: 16px; align-items: flex-end; flex-wrap: wrap; }
    
    .section-title { font-size: 10px; text-transform: uppercase; color: var(--text-muted); letter-spacing: 1px; margin-bottom: 8px; font-weight: 600; }
    
    .switches { display: flex; flex-direction: column; gap: 8px; min-width: 180px; }
    .switch-row { display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: #ddd; }
    
    .toggle-switch {
      width: 32px; height: 18px; background: rgba(255,255,255,0.1); border-radius: 10px; position: relative; cursor: pointer;
      transition: background 0.2s;
    }
    .toggle-switch::after {
      content:''; position: absolute; left: 2px; top: 2px; width: 14px; height: 14px; 
      background: #fff; border-radius: 50%; transition: 0.2s;
    }
    .toggle-switch.on { background: var(--accent); }
    .toggle-switch.on::after { transform: translateX(14px); }

    .sliders { min-width: 220px; display: flex; flex-direction: column; gap: 12px; }
    .slider-group { display: flex; flex-direction: column; gap: 4px; }
    .slider-label { font-size: 11px; display: flex; justify-content: space-between; color: var(--text-muted); }
    input[type=range] { width: 100%; accent-color: var(--accent); height: 4px; }

    .types { display: flex; flex-wrap: wrap; gap: 6px; max-width: 260px; }
    .type-btn {
      padding: 4px 10px; font-size: 10px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px; color: #aaa; cursor: pointer; text-transform: uppercase; transition: all 0.2s;
    }
    .type-btn:hover { background: rgba(255,255,255,0.05); }
    .type-btn.active { background: var(--accent); color: #fff; border-color: var(--accent); }

    @media(max-width: 700px) {
      .ui-bottom { flex-direction: column; align-items: flex-start; }
      .panel { width: 100%; max-width: none; }
    }
  </style>
</head>
<body>

  <canvas id="c"></canvas>

  <div class="ui-root">
    <div class="ui-top">
      <div class="panel">
        <div class="app-title">Neon Sky 3D <span class="badge">PRO</span></div>
        <div class="metrics">
          <div class="metric">FPS <b id="ui-fps">0</b></div>
          <div class="metric">Particles <b id="ui-particles">0</b></div>
        </div>
        
        <div class="launch-area">
          <div style="font-size:11px; color:var(--text-muted); line-height:1.4;">
            Tap Screen to Launch<br>Hold Pad for Mega
          </div>
          <button id="launch-pad" class="launch-btn">LAUNCH</button>
        </div>
      </div>
    </div>

    <div class="ui-bottom">
      
      <div class="panel switches">
        <div class="section-title">Visuals & Audio</div>
        <div class="switch-row">
          <span>Bloom / Glow</span>
          <div class="toggle-switch on" id="sw-bloom"></div>
        </div>
        <div class="switch-row">
          <span>Shockwaves</span>
          <div class="toggle-switch on" id="sw-shock"></div>
        </div>
        <div class="switch-row">
          <span>Sparkle</span>
          <div class="toggle-switch on" id="sw-sparkle"></div>
        </div>
        <div class="switch-row">
          <span>Sound FX</span>
          <div class="toggle-switch" id="sw-sound"></div>
        </div>
      </div>

      <div class="panel sliders">
        <div class="section-title">Performance</div>
        <div class="slider-group">
          <div class="slider-label"><span>Max Particles</span><span id="val-max">1500</span></div>
          <input type="range" min="500" max="4000" step="100" value="1500" id="sl-max">
        </div>
        <div class="slider-group">
          <div class="slider-label"><span>Auto-Fire Rate</span><span id="val-auto">Off</span></div>
          <input type="range" min="0" max="3" step="1" value="0" id="sl-auto">
        </div>
      </div>

      <div class="panel">
        <div class="section-title">Explosion Shape</div>
        <div class="types" id="type-container">
          <button class="type-btn" data-t="random">ðŸŽ² Random</button>
          <button class="type-btn active" data-t="classic">Classic</button>
          <button class="type-btn" data-t="willow">Willow</button>
          <button class="type-btn" data-t="palm">Palm</button>
          <button class="type-btn" data-t="ring">Ring</button>
          <button class="type-btn" data-t="heart">Heart</button>
          <button class="type-btn" data-t="star">Star</button>
          <button class="type-btn" data-t="spiral">Spiral</button>
          <button class="type-btn" data-t="galaxy">Galaxy</button>
        </div>
      </div>

    </div>
  </div>

<script>
(() => {
  'use strict';

  const state = {
    maxParticles: 1500,
    bloom: true,
    shockwaves: true,
    sparkle: true,
    sound: false,
    autoFireLevel: 0,
    currentType: 'classic'
  };

  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d');
  
  const els = {
    fps: document.getElementById('ui-fps'),
    pc: document.getElementById('ui-particles'),
    launch: document.getElementById('launch-pad'),
    swBloom: document.getElementById('sw-bloom'),
    swShock: document.getElementById('sw-shock'),
    swSparkle: document.getElementById('sw-sparkle'),
    swSound: document.getElementById('sw-sound'),
    slMax: document.getElementById('sl-max'),
    valMax: document.getElementById('val-max'),
    slAuto: document.getElementById('sl-auto'),
    valAuto: document.getElementById('val-auto'),
    typeBtns: document.querySelectorAll('.type-btn')
  };

  let W, H, dpr;
  let particles = [];
  let rockets = [];
  let shocks = [];
  let audioCtx = null;

  const TAU = Math.PI * 2;
  const rand = (min, max) => Math.random() * (max - min) + min;
  const randInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
  
  // Shape Data
  const HEART_POINTS = [];
  for(let i=0; i<60; i++) {
    const t = (i/60)*TAU;
    const x = 16 * Math.pow(Math.sin(t), 3);
    const y = -(13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t));
    HEART_POINTS.push({x, y});
  }

  const STAR_POINTS = [];
  for(let i=0; i<10; i++) {
    const r = (i % 2 === 0) ? 1 : 0.45;
    const a = (i/10) * TAU - Math.PI/2;
    STAR_POINTS.push({x: Math.cos(a)*r*15, y: Math.sin(a)*r*15});
  }

  function unlockAudio() {
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if(audioCtx.state === 'suspended') audioCtx.resume();
  }

  function playBoom() {
    if(!state.sound || !audioCtx) return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    
    osc.frequency.setValueAtTime(rand(80, 150), audioCtx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(40, audioCtx.currentTime + 0.15);
    
    gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
    
    osc.connect(gain).connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 0.35);
  }

  function resize() {
    dpr = window.devicePixelRatio || 1;
    W = window.innerWidth;
    H = window.innerHeight;
    canvas.width = W * dpr;
    canvas.height = H * dpr;
    ctx.scale(dpr, dpr);
  }
  window.addEventListener('resize', resize);
  resize();

  class Particle {
    constructor(x, y, vx, vy, col, type) {
      this.x = x; this.y = y;
      this.vx = vx; this.vy = vy;
      this.col = col;
      this.life = rand(1.0, 1.8);
      this.age = 0;
      this.size = rand(1.5, 3.0);
      this.drag = 0.98;
      this.grav = 0.8;
      this.type = type;
    }
    update(dt) {
      this.age += dt;
      this.vx *= this.drag;
      this.vy *= this.drag;
      this.vy += 80 * dt;
      this.x += this.vx * dt;
      this.y += this.vy * dt;
    }
    draw(ctx) {
      const p = this.age / this.life;
      if (p > 1) return;
      
      ctx.globalAlpha = 1 - p;
      ctx.fillStyle = this.col;
      
      if (state.sparkle && Math.random() < 0.2) {
        ctx.fillStyle = "#fff";
      }

      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size, 0, TAU);
      ctx.fill();
    }
  }

  class Rocket {
    constructor(x, targetY) {
      this.x = x;
      this.y = H;
      this.targetY = targetY;
      this.vy = rand(-600, -750);
      this.col = `hsl(${randInt(0,360)}, 100%, 70%)`;
      this.dead = false;
      this.trail = [];
    }
    update(dt) {
      this.vy += 250 * dt;
      this.y += this.vy * dt;
      
      this.trail.push({x:this.x, y:this.y});
      if(this.trail.length > 8) this.trail.shift();

      if (this.vy > -50 || this.y < this.targetY) {
        this.dead = true;
        createExplosion(this.x, this.y, this.col);
      }
    }
    draw(ctx) {
      ctx.strokeStyle = this.col;
      ctx.lineWidth = 3;
      ctx.beginPath();
      if(this.trail.length > 1) {
        ctx.moveTo(this.trail[0].x, this.trail[0].y);
        for(let i=1; i<this.trail.length; i++) {
          ctx.lineTo(this.trail[i].x, this.trail[i].y);
        }
        ctx.stroke();
      }
      ctx.fillStyle = "#fff";
      ctx.fillRect(this.x-1.5, this.y-4, 3, 4);
    }
  }

  class Shockwave {
    constructor(x, y, col) {
      this.x = x; this.y = y; this.col = col;
      this.r = 1;
      this.age = 0;
      this.life = 0.5;
    }
    update(dt) {
      this.age += dt;
      this.r += 600 * dt;
    }
    draw(ctx) {
      const p = this.age / this.life;
      if (p > 1) return;
      ctx.strokeStyle = this.col;
      ctx.lineWidth = 4 * (1-p);
      ctx.globalAlpha = 0.5 * (1-p);
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.r, 0, TAU);
      ctx.stroke();
    }
  }

  function createExplosion(x, y, color) {
    playBoom();

    if (state.shockwaves) {
      shocks.push(new Shockwave(x, y, color));
    }

    // Select random type if random mode is active
    let type = state.currentType;
    if (type === 'random') {
      const types = ['classic', 'willow', 'palm', 'ring', 'heart', 'star', 'spiral', 'galaxy'];
      type = types[randInt(0, types.length - 1)];
    }
    let count = 100;
    
    if (type === 'heart') {
      HEART_POINTS.forEach(pt => {
        const velMult = rand(6, 12);
        particles.push(new Particle(x, y, pt.x * velMult, pt.y * velMult, color));
      });
      for(let i=0; i<30; i++) particles.push(new Particle(x, y, rand(-50,50), rand(-50,50), color));
      return;
    }

    if (type === 'star') {
       STAR_POINTS.forEach(pt => {
        const velMult = rand(8, 14);
        particles.push(new Particle(x, y, pt.x * velMult, pt.y * velMult, color));
      });
      for(let i=0; i<30; i++) particles.push(new Particle(x, y, rand(-50,50), rand(-50,50), color));
      return;
    }

    if (type === 'ring') {
      for(let i=0; i<80; i++) {
        const a = (i/80)*TAU;
        const s = rand(150, 180);
        particles.push(new Particle(x, y, Math.cos(a)*s, Math.sin(a)*s, color));
      }
      return;
    }

    if (type === 'spiral') {
      for(let i=0; i<120; i++) {
        const a = (i/120)*TAU*3;
        const r = (i/120) * 200;
        const vx = Math.cos(a) * r;
        const vy = Math.sin(a) * r;
        const p = new Particle(x, y, vx, vy, color);
        p.life = 2.0;
        particles.push(p);
      }
      return;
    }

    if (type === 'galaxy') {
      const arms = 3;
      for(let i=0; i<150; i++) {
        const arm = i % arms;
        const t = (i/150) * TAU * 2;
        const r = (i/150) * 180;
        const a = t + (arm * TAU/arms);
        const vx = Math.cos(a) * r;
        const vy = Math.sin(a) * r;
        const p = new Particle(x, y, vx, vy, color);
        p.life = 2.2;
        p.drag = 0.99;
        particles.push(p);
      }
      return;
    }

    if (type === 'willow') count = 150;
    
    for(let i=0; i<count; i++) {
      const a = rand(0, TAU);
      let s = rand(50, 250);
      
      let vx = Math.cos(a) * s;
      let vy = Math.sin(a) * s;

      let p = new Particle(x, y, vx, vy, color);
      
      if (type === 'palm') {
        p.drag = 0.96;
        if(Math.random() > 0.5) p.life = 2.2;
      } else if (type === 'willow') {
        p.drag = 0.99;
        p.grav = 20;
        p.life = 2.5;
      }

      particles.push(p);
    }
  }

  function launchRocket(isMega) {
    unlockAudio();
    const count = isMega ? 5 : 1;
    for(let i=0; i<count; i++) {
      const x = isMega ? W/2 + rand(-100, 100) : rand(W*0.1, W*0.9);
      const targetY = rand(H*0.1, H*0.4);
      rockets.push(new Rocket(x, targetY));
    }
  }

  ['swBloom', 'swShock', 'swSparkle', 'swSound'].forEach(k => {
    els[k].addEventListener('click', () => {
      const key = k.replace('sw', '').toLowerCase();
      const prop = key === 'shock' ? 'shockwaves' : key;
      state[prop] = !state[prop];
      els[k].classList.toggle('on', state[prop]);
    });
  });

  els.slMax.addEventListener('input', (e) => {
    state.maxParticles = parseInt(e.target.value);
    els.valMax.innerText = state.maxParticles;
  });

  els.slAuto.addEventListener('input', (e) => {
    const v = parseInt(e.target.value);
    state.autoFireLevel = v;
    const labels = ['Off', 'Slow', 'Med', 'Fast'];
    els.valAuto.innerText = labels[v];
  });

  els.typeBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      els.typeBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      state.currentType = btn.dataset.t;
    });
  });

  let holdTimer;
  const startHold = (e) => {
    e.preventDefault();
    unlockAudio();
    els.launch.classList.add('holding');
    holdTimer = setTimeout(() => {
      launchRocket(true);
    }, 600);
  };
  const endHold = (e) => {
    e.preventDefault();
    els.launch.classList.remove('holding');
    if (holdTimer) {
      clearTimeout(holdTimer);
      launchRocket(false);
      holdTimer = null;
    }
  };

  els.launch.addEventListener('mousedown', startHold);
  els.launch.addEventListener('touchstart', startHold);
  els.launch.addEventListener('mouseup', endHold);
  els.launch.addEventListener('mouseleave', endHold);
  els.launch.addEventListener('touchend', endHold);
  els.launch.addEventListener('touchcancel', endHold);

  canvas.addEventListener('click', (e) => {
    unlockAudio();
    const rect = canvas.getBoundingClientRect();
    const x = (e.clientX - rect.left) / (rect.width/W);
    const y = (e.clientY - rect.top) / (rect.height/H);
    createExplosion(x, y, `hsl(${randInt(0,360)}, 100%, 70%)`);
  });

  let lastTime = 0;
  let autoTimer = 0;
  let frameCount = 0;
  let lastFpsTime = 0;

  function loop(time) {
    requestAnimationFrame(loop);
    const dt = Math.min((time - lastTime) / 1000, 0.05);
    lastTime = time;

    if (state.autoFireLevel > 0) {
      autoTimer += dt;
      const threshold = [99, 1.2, 0.6, 0.2][state.autoFireLevel];
      if (autoTimer > threshold) {
        launchRocket(false);
        autoTimer = 0;
      }
    }

    ctx.globalCompositeOperation = 'destination-out';
    ctx.fillStyle = `rgba(0, 0, 0, ${state.bloom ? 0.2 : 0.4})`;
    ctx.fillRect(0, 0, W, H);

    ctx.globalCompositeOperation = state.bloom ? 'lighter' : 'source-over';

    shocks = shocks.filter(s => s.age < s.life);
    shocks.forEach(s => { s.update(dt); s.draw(ctx); });

    rockets = rockets.filter(r => !r.dead);
    rockets.forEach(r => { r.update(dt); r.draw(ctx); });

    particles = particles.filter(p => p.age < p.life);
    if (particles.length > state.maxParticles) {
      particles.splice(0, particles.length - state.maxParticles);
    }
    particles.forEach(p => { p.update(dt); p.draw(ctx); });

    frameCount++;
    if (time - lastFpsTime > 1000) {
      els.fps.innerText = Math.round(frameCount);
      frameCount = 0;
      lastFpsTime = time;
      els.pc.innerText = particles.length;
    }
  }

  requestAnimationFrame(loop);

})();
</script>
</body>
</html>